<script>
(function(){
  // Lingua dal selettore esistente
  const sel = document.getElementById('langSelect');
  const getLang = () => (sel && sel.value ? sel.value : (navigator.language || 'en')).toLowerCase();

  // 40 lingue (chiavi minime per il form)
  const T = {
    "en":{title:"Contact support",name:"Your name",email:"Your email",message:"Message",consent:"I agree to be contacted via the email provided.",send:"Send",cancel:"Cancel",okTitle:"Sent!",ok:"Thanks — we'll reply soon.",err:"Please fill all fields and accept the consent."},
    "it":{title:"Contatta il supporto",name:"Il tuo nome",email:"La tua email",message:"Messaggio",consent:"Acconsento ad essere contattato all'email indicata.",send:"Invia",cancel:"Annulla",okTitle:"Inviato!",ok:"Grazie — ti risponderemo a breve.",err:"Compila tutti i campi e accetta il consenso."},
    "es":{title:"Contactar soporte",name:"Tu nombre",email:"Tu correo",message:"Mensaje",consent:"Acepto ser contactado por el correo proporcionado.",send:"Enviar",cancel:"Cancelar",okTitle:"¡Enviado!",ok:"Gracias — responderemos pronto.",err:"Completa todos los campos y acepta el consentimiento."},
    "fr":{title:"Contacter l'assistance",name:"Votre nom",email:"Votre e-mail",message:"Message",consent:"J'accepte d'être contacté à l'e-mail fourni.",send:"Envoyer",cancel:"Annuler",okTitle:"Envoyé !",ok:"Merci — nous vous répondrons bientôt.",err:"Veuillez remplir tous les champs et accepter le consentement."},
    "de":{title:"Support kontaktieren",name:"Dein Name",email:"Deine E-Mail",message:"Nachricht",consent:"Ich stimme zu, per angegebener E-Mail kontaktiert zu werden.",send:"Senden",cancel:"Abbrechen",okTitle:"Gesendet!",ok:"Danke — wir melden uns bald.",err:"Bitte alle Felder ausfüllen und zustimmen."},
    "pt":{title:"Contactar suporte",name:"Seu nome",email:"Seu e-mail",message:"Mensagem",consent:"Concordo em ser contatado pelo e-mail informado.",send:"Enviar",cancel:"Cancelar",okTitle:"Enviado!",ok:"Obrigado — responderemos em breve.",err:"Preencha todos os campos e aceite o consentimento."},
    "pt-br":{title:"Falar com o suporte",name:"Seu nome",email:"Seu e-mail",message:"Mensagem",consent:"Concordo em ser contatado pelo e-mail informado.",send:"Enviar",cancel:"Cancelar",okTitle:"Enviado!",ok:"Valeu — responderemos em breve.",err:"Preencha todos os campos e aceite o consentimento."},
    "ru":{title:"Связаться с поддержкой",name:"Ваше имя",email:"Ваш e-mail",message:"Сообщение",consent:"Согласен на связь по указанной почте.",send:"Отправить",cancel:"Отмена",okTitle:"Отправлено!",ok:"Спасибо — ответим в ближайшее время.",err:"Заполните все поля и дайте согласие."},
    "uk":{title:"Зв'язатися з підтримкою",name:"Ваше ім'я",email:"Ваш e-mail",message:"Повідомлення",consent:"Погоджуюся на зв'язок за вказаною поштою.",send:"Надіслати",cancel:"Скасувати",okTitle:"Надіслано!",ok:"Дякуємо — відповімо найближчим часом.",err:"Заповніть усі поля та прийміть згоду."},
    "pl":{title:"Kontakt z pomocą",name:"Twoje imię",email:"Twój e-mail",message:"Wiadomość",consent:"Zgadzam się na kontakt na podany e-mail.",send:"Wyślij",cancel:"Anuluj",okTitle:"Wysłano!",ok:"Dziękujemy — odpiszemy wkrótce.",err:"Uzupełnij wszystkie pola i zaakceptuj zgodę."},
    "nl":{title:"Contact met support",name:"Je naam",email:"Je e-mail",message:"Bericht",consent:"Ik ga akkoord om via e-mail te worden gecontacteerd.",send:"Versturen",cancel:"Annuleren",okTitle:"Verzonden!",ok:"Bedankt — we reageren snel.",err:"Vul alle velden in en ga akkoord met de toestemming."},
    "sv":{title:"Kontakta support",name:"Ditt namn",email:"Din e-post",message:"Meddelande",consent:"Jag samtycker till kontakt via angiven e-post.",send:"Skicka",cancel:"Avbryt",okTitle:"Skickat!",ok:"Tack — vi hör av oss snart.",err:"Fyll i alla fält och godkänn samtycket."},
    "no":{title:"Kontakt support",name:"Ditt navn",email:"Din e-post",message:"Melding",consent:"Jeg samtykker til å bli kontaktet på e-posten.",send:"Send",cancel:"Avbryt",okTitle:"Sendt!",ok:"Takk — vi svarer snart.",err:"Fyll ut alle felt og godta samtykke."},
    "da":{title:"Kontakt support",name:"Dit navn",email:"Din e-mail",message:"Besked",consent:"Jeg accepterer at blive kontaktet via e-mail.",send:"Send",cancel:"Annullér",okTitle:"Sendt!",ok:"Tak — vi vender snart tilbage.",err:"Udfyld alle felter og accepter samtykke."},
    "fi":{title:"Ota yhteyttä tukeen",name:"Nimesi",email:"Sähköpostisi",message:"Viesti",consent:"Hyväksyn yhteydenoton sähköpostitse.",send:"Lähetä",cancel:"Peruuta",okTitle:"Lähetetty!",ok:"Kiitos — vastaamme pian.",err:"Täytä kaikki kentät ja hyväksy suostumus."},
    "tr":{title:"Destekle iletişime geç",name:"Adın",email:"E-postan",message:"Mesaj",consent:"Belirttiğim e-posta üzerinden iletişime geçilmesine izin veriyorum.",send:"Gönder",cancel:"İptal",okTitle:"Gönderildi!",ok:"Teşekkürler — yakında yanıt vereceğiz.",err:"Tüm alanları doldur ve onayı kabul et."},
    "el":{title:"Επικοινωνία με υποστήριξη",name:"Το όνομά σου",email:"Το e-mail σου",message:"Μήνυμα",consent:"Συμφωνώ να επικοινωνήσουν μαζί μου στο e-mail.",send:"Αποστολή",cancel:"Ακύρωση",okTitle:"Εστάλη!",ok:"Ευχαριστούμε — θα απαντήσουμε σύντομα.",err:"Συμπλήρωσε όλα τα πεδία και αποδέξου τη συγκατάθεση."},
    "cs":{title:"Kontaktovat podporu",name:"Tvé jméno",email:"Tvůj e-mail",message:"Zpráva",consent:"Souhlasím s kontaktováním na uvedený e-mail.",send:"Odeslat",cancel:"Zrušit",okTitle:"Odesláno!",ok:"Díky — brzy odpovíme.",err:"Vyplň všechna pole a přijmi souhlas."},
    "sk":{title:"Kontaktovať podporu",name:"Tvoje meno",email:"Tvoj e-mail",message:"Správa",consent:"Súhlasím s kontaktovaním na e-mail.",send:"Odoslať",cancel:"Zrušiť",okTitle:"Odoslané!",ok:"Ďakujeme — čoskoro odpovieme.",err:"Vyplň všetky polia a odsúhlas súhlas."},
    "hu":{title:"Kapcsolatfelvétel támogatással",name:"Neved",email:"E-mailed",message:"Üzenet",consent:"Hozzájárulok az e-mailes megkereséshez.",send:"Küldés",cancel:"Mégse",okTitle:"Elküldve!",ok:"Köszönjük — hamarosan válaszolunk.",err:"Töltsd ki az összes mezőt és fogadd el a hozzájárulást."},
    "ro":{title:"Contactează suportul",name:"Numele tău",email:"Emailul tău",message:"Mesaj",consent:"Sunt de acord să fiu contactat pe emailul furnizat.",send:"Trimite",cancel:"Anulează",okTitle:"Trimis!",ok:"Mulțumim — revenim curând.",err:"Completează toate câmpurile și acceptă consimțământul."},
    "bg":{title:"Свържи се с поддръжка",name:"Твоето име",email:"Твоят e-mail",message:"Съобщение",consent:"Съгласен/на съм да бъда потърсен/а по e-mail.",send:"Изпрати",cancel:"Откажи",okTitle:"Изпратено!",ok:"Благодарим — скоро ще отговорим.",err:"Попълни всички полета и приеми съгласието."},
    "sr":{title:"Контакт подршка",name:"Твоје име",email:"Твој е-мејл",message:"Порука",consent:"Прихватам контакт на наведени е-мејл.",send:"Пошаљи",cancel:"Откажи",okTitle:"Послато!",ok:"Хвала — ускоро одговарамо.",err:"Попуни сва поља и прихвати сагласност."},
    "hr":{title:"Kontaktiraj podršku",name:"Tvoje ime",email:"Tvoj e-mail",message:"Poruka",consent:"Slažem se na kontakt putem e-pošte.",send:"Pošalji",cancel:"Odustani",okTitle:"Poslano!",ok:"Hvala — ubrzo odgovaramo.",err:"Ispuni sva polja i prihvati privolu."},
    "sl":{title:"Kontaktiraj podporo",name:"Tvoje ime",email:"Tvoj e-poštni naslov",message:"Sporočilo",consent:"Strinjam se s stikom prek navedenega e-poštnega naslova.",send:"Pošlji",cancel:"Prekliči",okTitle:"Poslano!",ok:"Hvala — kmalu odgovorimo.",err:"Izpolni vsa polja in sprejmi soglasje."},
    "he":{title:"צור קשר עם התמיכה",name:"השם שלך",email:"האימייל שלך",message:"הודעה",consent:"אני מסכים/ה שיצרו איתי קשר למייל שסיפקתי.",send:"שלח",cancel:"ביטול",okTitle:"נשלח!",ok:"תודה — נחזור אליך בקרוב.",err:"מלא/י את כל השדות ואשר/י הסכמה."},
    "ar":{title:"الاتصال بالدعم",name:"اسمك",email:"بريدك الإلكتروني",message:"الرسالة",consent:"أوافق على التواصل معي عبر البريد المذكور.",send:"إرسال",cancel:"إلغاء",okTitle:"تم الإرسال!",ok:"شكرًا — سنرد قريبًا.",err:"املأ جميع الحقول ووافق على الإقرار."},
    "fa":{title:"ارتباط با پشتیبانی",name:"نام شما",email:"ایمیل شما",message:"پیام",consent:"موافقت می‌دهم از طریق ایمیل درج‌شده با من تماس بگیرند.",send:"ارسال",cancel:"لغو",okTitle:"ارسال شد!",ok:"متشکرم — به‌زودی پاسخ می‌دهیم.",err:"همه فیلدها را پر کرده و رضایت را بپذیرید."},
    "hi":{title:"सपोर्ट से संपर्क",name:"आपका नाम",email:"आपका ई-मेल",message:"संदेश",consent:"मैं दिए ई-मेल पर संपर्क के लिए सहमत हूँ।",send:"भेजें",cancel:"रद्द करें",okTitle:"भेज दिया!",ok:"धन्यवाद — हम जल्द जवाब देंगे।",err:"कृपया सभी फ़ील्ड भरें और सहमति दें।"},
    "bn":{title:"সাপোর্টে যোগাযোগ",name:"আপনার নাম",email:"আপনার ই-মেইল",message:"বার্তা",consent:"আমি প্রদত্ত ই-মেইলে যোগাযোগে সম্মত।",send:"পাঠান",cancel:"বাতিল",okTitle:"পাঠানো হয়েছে!",ok:"ধন্যবাদ — আমরা দ্রুত উত্তর দেব।",err:"সব ঘর পূরণ করুন এবং সম্মতি দিন।"},
    "ur":{title:"سپورٹ سے رابطہ",name:"آپ کا نام",email:"آپ کی ای میل",message:"پیغام",consent:"میں دی گئی ای میل پر رابطے کی اجازت دیتا/دیتی ہوں۔",send:"بھیجیں",cancel:"منسوخ",okTitle:"بھیج دیا!",ok:"شکریہ — ہم جلد جواب دیں گے۔",err:"تمام فیلڈز پُر کریں اور رضامندی دیں۔"},
    "zh-cn":{title:"联系支持",name:"您的姓名",email:"您的邮箱",message:"留言",consent:"我同意通过所提供邮箱联系我。",send:"发送",cancel:"取消",okTitle:"已发送！",ok:"感谢—我们将尽快回复。",err:"请填写所有字段并勾选同意。"},
    "zh-tw":{title:"聯絡支援",name:"您的姓名",email:"您的信箱",message:"訊息",consent:"我同意透過提供的信箱聯絡我。",send:"送出",cancel:"取消",okTitle:"已送出！",ok:"感謝—我們將盡快回覆。",err:"請填寫所有欄位並勾選同意。"},
    "ja":{title:"サポートへ連絡",name:"お名前",email:"メール",message:"メッセージ",consent:"記載のメール宛に連絡することに同意します。",send:"送信",cancel:"キャンセル",okTitle:"送信完了！",ok:"ありがとうございます。追ってご連絡します。",err:"全項目を入力し、同意にチェックしてください。"},
    "ko":{title:"고객 지원 문의",name:"이름",email:"이메일",message:"메시지",consent:"제공된 이메일로 연락받는 것에 동의합니다.",send:"보내기",cancel:"취소",okTitle:"전송 완료!",ok:"감사합니다 — 곧 회신드리겠습니다.",err:"모든 항목을 입력하고 동의에 체크하세요."},
    "th":{title:"ติดต่อฝ่ายสนับสนุน",name:"ชื่อของคุณ",email:"อีเมลของคุณ",message:"ข้อความ",consent:"ยินยอมให้ติดต่อผ่านอีเมลที่ให้ไว้",send:"ส่ง",cancel:"ยกเลิก",okTitle:"ส่งแล้ว!",ok:"ขอบคุณ — เราจะติดต่อกลับเร็วๆ นี้",err:"กรอกทุกช่องและยอมรับข้อตกลง"},
    "vi":{title:"Liên hệ hỗ trợ",name:"Tên của bạn",email:"Email của bạn",message:"Nội dung",consent:"Tôi đồng ý được liên hệ qua email đã cung cấp.",send:"Gửi",cancel:"Hủy",okTitle:"Đã gửi!",ok:"Cảm ơn — chúng tôi sẽ phản hồi sớm.",err:"Vui lòng điền đủ và chấp thuận."},
    "id":{title:"Hubungi dukungan",name:"Nama Anda",email:"Email Anda",message:"Pesan",consent:"Saya setuju dihubungi lewat email yang diberikan.",send:"Kirim",cancel:"Batal",okTitle:"Terkirim!",ok:"Terima kasih — kami akan segera membalas.",err:"Isi semua kolom dan setujui persetujuan."},
    "ms":{title:"Hubungi sokongan",name:"Nama anda",email:"Emel anda",message:"Mesej",consent:"Saya setuju dihubungi melalui emel yang diberi.",send:"Hantar",cancel:"Batal",okTitle:"Dihantar!",ok:"Terima kasih — kami akan balas segera.",err:"Sila isi semua medan dan setuju."},
    "fil":{title:"Makipag-ugnayan sa support",name:"Iyong pangalan",email:"Iyong email",message:"Mensahe",consent:"Sumasang-ayon akong kontakin sa ibinigay na email.",send:"Ipadala",cancel:"Kanselahin",okTitle:"Naipadala!",ok:"Salamat — sasagot kami kaagad.",err:"Punan lahat ng fields at tanggapin ang pahintulot."}
  };
  const F = (k) => {
    let lang = getLang();
    if (!T[lang]) lang = lang.split('-')[0];
    if (!T[lang]) lang = 'en';
    return T[lang][k] || T['en'][k] || k;
  };

  // UI refs
  const modal = document.getElementById('supportModal');
  const openBtn = document.getElementById('openSupport');
  const closeBtn = document.getElementById('closeSupport');
  const sTitle = document.getElementById('s_title');
  const sNameLbl = document.getElementById('s_name_lbl');
  const sEmailLbl = document.getElementById('s_email_lbl');
  const sMsgLbl = document.getElementById('s_msg_lbl');
  const sConsentLbl = document.getElementById('s_consent_lbl');
  const sCancel = document.getElementById('s_cancel');
  const sSend = document.getElementById('s_send');
  const sErr = document.getElementById('s_error');
  const sOK = document.getElementById('s_ok');

  function applyI18n(){
    sTitle.textContent = F('title');
    sNameLbl.textContent = F('name');
    sEmailLbl.textContent = F('email');
    sMsgLbl.textContent = F('message');
    sConsentLbl.textContent = F('consent');
    sCancel.textContent = F('cancel');
    sSend.textContent = F('send');
  }

  openBtn?.addEventListener('click', (e)=>{ e.preventDefault(); applyI18n(); sErr.classList.add('hidden'); sOK.classList.add('hidden'); modal.classList.add('show'); });
  closeBtn?.addEventListener('click', ()=> modal.classList.remove('show'));
  sCancel?.addEventListener('click', (e)=>{ e.preventDefault(); modal.classList.remove('show'); });
  sel?.addEventListener('change', ()=>{ if (modal.classList.contains('show')) applyI18n(); });

  // helper: encode x-www-form-urlencoded
  function encode(data){
    return Object.keys(data).map(k => encodeURIComponent(k) + '=' + encodeURIComponent(data[k])).join('&');
  }

  document.getElementById('s_send')?.addEventListener('click', async (e)=>{
    e.preventDefault();
    const name = document.getElementById('s_name').value.trim();
    const email = document.getElementById('s_email').value.trim();
    const msg = document.getElementById('s_msg').value.trim();
    const consent = document.getElementById('s_consent').checked;
    if (!name || !email || !msg || !consent) {
      sErr.textContent = F('err'); sErr.classList.remove('hidden'); sOK.classList.add('hidden'); return;
    }

    const payload = {
      "form-name":"support",
      "name": name,
      "email": email,
      "message": msg,
      "consent": "yes",
      "lang": getLang()
    };

    try{
      // invia a Netlify Forms
      const res = await fetch('/', {
        method: 'POST',
        headers: { 'Content-Type':'application/x-www-form-urlencoded' },
        body: encode(payload)
      });
      if (res.ok) {
        sOK.textContent = F('ok'); sOK.classList.remove('hidden'); sErr.classList.add('hidden');
        // reset campi
        document.getElementById('s_name').value='';
        document.getElementById('s_email').value='';
        document.getElementById('s_msg').value='';
        document.getElementById('s_consent').checked=false;
        // chiudi dopo poco
        setTimeout(()=> modal.classList.remove('show'), 1200);
      } else {
        sErr.textContent = 'Send error'; sErr.classList.remove('hidden'); sOK.classList.add('hidden');
      }
    } catch(err){
      sErr.textContent = 'Network error'; sErr.classList.remove('hidden'); sOK.classList.add('hidden');
    }
  });
})();
</script>
